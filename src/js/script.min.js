function getDeviceId(){FingerprintJS.load({apiKey:"a1ZJOENnGt4QCgAqBHHb",region:"eu",endpoint:"https://login.geoscout.uk"}).then(t=>t.get()).then(t=>{localStorage.setItem("deviceId",t.visitorId)}).catch(t=>{console.warn(t)})}function getApiAuth(){return FingerprintJS.load({apiKey:"a1ZJOENnGt4QCgAqBHHb",region:"eu",endpoint:"https://login.geoscout.uk"}).then(t=>t.get()).then(t=>({requestId:t.requestId,deviceId:t.visitorId})).catch(t=>{showError(t,!1)})}function showError(t,e){console.log(`Showing error message: ${t}`),e?Swal.fire({title:"Application error",text:t,icon:"error",buttonsStyling:!1,customClass:{confirmButton:"btn btn-primary"},didOpen:()=>{Swal.hideLoading()}}):Swal.fire({title:"Application error",text:t,icon:"error",showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,didOpen:()=>{Swal.hideLoading()}})}function setLoadingIndicator(t,e){t?(console.log("Show full screen loading indicator"),Swal.fire({title:`${e}...`,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,customClass:{loader:"custom-loader"},loaderHtml:'<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>',didOpen:()=>{Swal.showLoading()}})):(console.log("Remove full screen loading indicator"),Swal.close())}function prettyDate(t){const e=["January","February","March","April","May","June","July","August","September","October","November","December"],n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],a=new Date(t),i=e[a.getMonth()],o=n[a.getDay()],r=String(a.getDate()),d=`${r}${"1"===r||"21"===r||"31"===r?"st":"2"===r||"22"===r?"nd":"3"===r||"23"===r?"rd":"th"}`;return`${o} ${d} of ${i} ${a.getFullYear()}`}function handleErrors(t){if(t.hasOwnProperty("error"))throw Error(t.error);if(t.hasOwnProperty("errorMessage"))throw Error(`${t.errorType}: ${t.errorMessage}`);return t}function changePage(t,e,n){document.querySelector("link[rel='canonical']").setAttribute("href","404"===t?"https://www.geoscout.uk":n?`https://www.geoscout.uk/${t}-${n}`:`https://www.geoscout.uk/${t}`),document.querySelectorAll("a.nav-link").forEach(e=>{e.getAttribute("data-page")===t?(e.setAttribute("class","nav-link active"),e.setAttribute("aria-current","page")):(e.setAttribute("class","nav-link"),e.removeAttribute("aria-current"))}),document.querySelectorAll("section").forEach(e=>{e.id!==t&&(e.setAttribute("class","row mx-auto d-none"),e.setAttribute("aria-hidden","true"))}),document.getElementById(t).setAttribute("class","row mx-auto"),document.getElementById(t).removeAttribute("aria-hidden"),document.title=`${e} | GeoScout`,window.scrollTo({top:0,left:0,behavior:"smooth"})}function loadCachesPage(){const t=document.getElementById("mapContainer");t.innerHTML=loadingGif;const e=new google.maps.plugins.loader.Loader({apiKey:"AIzaSyDoWhwCiUGlBzrTOFxS17QUjBT9-eh46C4",version:"quarterly",libraries:["drawing"],language:"en",region:"GB",id:"googleMapsScript"});let n;fetch("./api/get-caches",{method:"GET",headers:{"Device-Id":localStorage.getItem("deviceId")}}).then(t=>t.json()).then(handleErrors).then(t=>{if(!t.hasOwnProperty("caches"))throw"No caches found";return n=t.caches,e.load()}).then(n=>(t.innerHTML='<div id="mapFilter"></div><div id="mainMap"></div><div class="my-3 text-center"><a href="viewCachesTable" class="text-decoration-none" data-navigo><i class="bi bi-table" aria-hidden="true"></i>&nbsp;View map data as a table</a></div>',router.updatePageLinks(),mainMap=new n.maps.Map(document.getElementById("mainMap"),{center:{lat:51.80007,lng:.64038},zoom:13,minZoom:13,maxZoom:18,restriction:{latLngBounds:{north:51.826601357825716,east:.7474966992187326,south:51.773523020732,west:.5332633007812326},strictBounds:!0},mapId:"6b8e857a992e95a7",streetViewControl:!1,mapTypeControl:!1,fullscreenControl:!0}),e.load())).then(t=>{try{const e=n.map(e=>{const n=new t.maps.Marker({position:{lat:Number(DOMPurify.sanitize(e.coordinates).split(",")[0]),lng:Number(DOMPurify.sanitize(e.coordinates).split(",")[1])},map:mainMap,title:`Cache ${DOMPurify.sanitize(e.id)}`,label:{text:DOMPurify.sanitize(e.id),color:"#ffffff",fontSize:"16px"},animation:t.maps.Animation.DROP,icon:{url:Boolean(e.found)?"./img/found.png":"./img/notFound.png",labelOrigin:new t.maps.Point(22,20)},optimized:!0});return n.addListener("click",()=>{router.navigate(`/viewCache-${e.id}`)}),n}),a=new markerClusterer.MarkerClusterer({map:mainMap,markers:e});return a}catch(t){throw console.warn(t),"Unable to load caches"}}).then(t=>{function e(e){if(a!==e){t.clearMarkers(),a=e;const i="all"===e?{found:!0,notFound:!0}:{found:"found"===e,notFound:"notFound"===e},o=[];n.forEach(t=>{if(t.found&&i.found||!t.found&&i.notFound){const e=new google.maps.Marker({position:{lat:Number(DOMPurify.sanitize(t.coordinates).split(",")[0]),lng:Number(DOMPurify.sanitize(t.coordinates).split(",")[1])},map:mainMap,title:`Cache ${DOMPurify.sanitize(t.id)}`,label:{text:DOMPurify.sanitize(t.id),color:"#ffffff",fontSize:"16px"},animation:google.maps.Animation.DROP,icon:{url:Boolean(t.found)?"./img/found.png":"./img/notFound.png",labelOrigin:new google.maps.Point(22,20)},optimized:!0});e.addListener("click",()=>{router.navigate(`/viewCache-${t.id}`)}),o.push(e)}}),t.addMarkers(o)}}let a="all";document.getElementById("mapFilter").innerHTML='<fieldset><div class="btn-group mb-3">\n\t\t\t\t<legend class="visually-hidden">Filter control for the map to toggle which caches are visible</legend>\n\t\t\t\t<input type="radio" class="btn-check" name="mapFilterBtn" id="mapFilterAll" autocomplete="off" value="all" checked>\n\t\t\t\t<label class="btn btn-outline-primary" for="mapFilterAll">All caches</label>\n\t\t\t\t<input type="radio" class="btn-check" name="mapFilterBtn" id="mapFilterNotFound" autocomplete="off" value="notFound">\n\t\t\t\t<label class="btn btn-outline-primary" for="mapFilterNotFound">Caches you haven\'t found</label>\n\t\t\t\t<input type="radio" class="btn-check" name="mapFilterBtn" id="mapFilterFound" autocomplete="off" value="found">\n\t\t\t\t<label class="btn btn-outline-primary" for="mapFilterFound">Caches you\'ve found</label>\n\t\t\t</div></fieldset>',["mapFilterAll","mapFilterNotFound","mapFilterFound"].forEach(t=>{document.getElementById(t).addEventListener("click",function(){e(document.querySelector('input[name="mapFilterBtn"]:checked').value)})})}).catch(t=>{showError(t,!1)}),changePage("viewCaches","View caches",!1)}function loadCachesTablePage(){const t=document.getElementById("tableContainer");let e;t.innerHTML=loadingGif,fetch("./api/get-caches",{method:"GET",headers:{"Device-Id":localStorage.getItem("deviceId")}}).then(t=>t.json()).then(handleErrors).then(t=>{if(t.hasOwnProperty("caches"))return e=t.caches,e;throw"No caches found"}).then(e=>{t.innerHTML='<div id="tableFilter"></div><div id="table"></div><div class="my-3 text-center"><a href="viewCaches" class="text-decoration-none" data-navigo><i class="bi bi-map" aria-hidden="true"></i>&nbsp;View table data in a map</a></div>';const n=new gridjs.Grid({columns:[{id:"id",name:"Cache ID",sort:{enabled:!0},formatter:t=>gridjs.html(`<a href="viewCache-${DOMPurify.sanitize(t)}" data-navigo>${DOMPurify.sanitize(t)}</a>`)},{id:"location",name:"what3words location",sort:{enabled:!0},formatter:t=>{const e=String(DOMPurify.sanitize(t)).split("///")[1];return gridjs.html(`<a href="https://what3words.com/${e}" target="_blank" translate="no">///${e}<span class="text-decoration-none ms-1"><i class="bi bi-box-arrow-up-right" aria-hidden="true"></i></span></a>`)}},{id:"found",name:gridjs.html('Found<span class="visually-hidden"> this cache</span>?'),sort:{enabled:!0},formatter:t=>t?"Yes ðŸ˜Š":"No â˜¹ï¸"},{id:"stats",name:"Stats",sort:{enabled:!0},formatter:t=>`${Number(t)>0?`Found by ${Number(t)} ${Number(t)>1?"people ðŸ˜Š":"person ðŸ˜®"}`:"No one has found this cache yet ðŸ˜¢"}`}],autoWidth:!1,sort:!0,pagination:{enabled:!0,limit:15,summary:!0},data:e}).render(document.getElementById("table"));return n.on("ready",function(){router.updatePageLinks()}),n}).then(t=>{function n(n){if(a!==n){a=n;const i="all"===n?{found:!0,notFound:!0}:{found:"found"===n,notFound:"notFound"===n},o=[];e.forEach(t=>{(t.found&&i.found||!t.found&&i.notFound)&&o.push(t)}),t.updateConfig({data:o}).forceRender()}}let a="all";document.getElementById("tableFilter").innerHTML='<fieldset><div class="btn-group mb-3">\n\t\t\t\t<legend class="visually-hidden">Filter control for the map to toggle which caches are visible</legend>\n\t\t\t\t<input type="radio" class="btn-check" name="tableFilterBtn" id="tableFilterAll" autocomplete="off" value="all" checked>\n\t\t\t\t<label class="btn btn-outline-primary" for="tableFilterAll">All caches</label>\n\t\t\t\t<input type="radio" class="btn-check" name="tableFilterBtn" id="tableFilterNotFound" autocomplete="off" value="notFound">\n\t\t\t\t<label class="btn btn-outline-primary" for="tableFilterNotFound">Caches you haven\'t found</label>\n\t\t\t\t<input type="radio" class="btn-check" name="tableFilterBtn" id="tableFilterFound" autocomplete="off" value="found">\n\t\t\t\t<label class="btn btn-outline-primary" for="tableFilterFound">Caches you\'ve found</label>\n\t\t\t</div></fieldset>',["tableFilterAll","tableFilterNotFound","tableFilterFound"].forEach(t=>{document.getElementById(t).addEventListener("click",function(){n(document.querySelector('input[name="tableFilterBtn"]:checked').value)})})}).catch(t=>{showError(t,!1)}),changePage("viewCachesTable","View caches",!1)}function loadCachePage(t){resetCachePage(),fetch("./api/get-cache",{method:"POST",body:JSON.stringify({cache:t}),headers:{"Content-Type":"application/json","Device-Id":localStorage.getItem("deviceId")}}).then(t=>t.json()).then(handleErrors).then(e=>{document.getElementById("cacheCard").removeAttribute("aria-hidden");const n=document.getElementById("cacheMapImg");n.setAttribute("src",`${DOMPurify.sanitize(e.image)}`),n.setAttribute("alt",`Map for Cache ${t}`);const a=document.getElementById("cacheHeader");a.setAttribute("class","card-title"),a.innerHTML="",a.innerText=`Cache ${t}`;const i=document.getElementById("cacheW3WLink");i.setAttribute("class","card-text");const o=String(DOMPurify.sanitize(e.location)).split("///")[1];i.innerHTML=`<p><strong>what3words address:</strong>&nbsp;<a href="https://what3words.com/${o}" target="_blank" translate="no">///${o}<span class="text-decoration-none ms-1"><i class="bi bi-box-arrow-up-right" aria-hidden="true"></i></span></a></p>\n\t\t\t<p><strong>Grid reference:</strong>&nbsp;<a href="https://explore.osmaps.com/pin?lat=${String(DOMPurify.sanitize(e.coordinates)).split(",")[0]}&lon=${String(DOMPurify.sanitize(e.coordinates)).split(",")[1]}&zoom=18.0000&overlays=&style=Standard&type=2d&placesCategory=" target="_blank">${DOMPurify.sanitize(e.gridRef)}<span class="text-decoration-none ms-1"><i class="bi bi-box-arrow-up-right" aria-hidden="true"></i></span></a><br><a class="text-decoration-none" href="https://getoutside.ordnancesurvey.co.uk/guides/beginners-guide-to-grid-references/" target="_blank">Learn more about grid references&nbsp;<i class="bi bi-box-arrow-up-right" aria-hidden="true"></i></a></p>\n\t\t\t<p><br><strong id="cacheStats"></strong></p>`;const r=document.getElementById("cacheW3WBtn");r.removeAttribute("tabindex"),r.setAttribute("class","btn btn-primary m-1"),r.setAttribute("href",`https://what3words.com/${o}`),r.setAttribute("target","_blank"),r.innerHTML='<i class="bi bi-geo-alt" aria-hidden="true"></i>&nbsp;Open in what3words';const d=document.getElementById("cacheMapsLink");d.removeAttribute("tabindex"),d.setAttribute("class","btn btn-primary m-1"),d.setAttribute("href",`https://www.google.com/maps/search/?api=1&query=${DOMPurify.sanitize(e.coordinates)}`),d.setAttribute("target","_blank"),d.innerHTML='<i class="bi bi-geo-alt" aria-hidden="true"></i>&nbsp;Open in Google Maps';const s=document.getElementById("cacheFoundLink"),c=document.getElementById("cacheStats");e.found?(s.setAttribute("class","btn btn-outline-primary m-1 disabled"),s.removeAttribute("tabindex"),s.innerHTML='<i class="bi bi-patch-check" aria-hidden="true"></i>&nbsp;You\'ve already found this cache',c.innerText=`You ${1===Number(e.stats)?"are the only person that has found this cache! ðŸ˜®":`and ${Number(e.stats)-1} other ${Number(e.stats)-1==1?"person has":"people have"} found this cache ðŸ˜Š`}`):(s.setAttribute("class","btn btn-outline-primary m-1"),s.setAttribute("href",`foundCache-${t}`),s.setAttribute("data-navigo",!0),s.removeAttribute("tabindex"),s.innerHTML='<i class="bi bi-123" aria-hidden="true"></i>&nbsp;Found this cache?',c.innerText=`${0===Number(e.stats)?"No one has found this cache yet ðŸ˜¢ can you find it?":`${Number(e.stats)} ${1===Number(e.stats)?"person has":"people have"} found this cache - can you find it?`}`,router.updatePageLinks())}).catch(t=>{showError(t,!1)}),changePage("viewCache",`Cache ${t}`,t)}function resetCachePage(){document.getElementById("cacheCard").setAttribute("aria-hidden","true");const t=document.getElementById("cacheMapImg");t.setAttribute("src","./img/loading.gif"),t.setAttribute("alt","Loading animation placeholder");const e=document.getElementById("cacheHeader");e.setAttribute("class","card-title placeholder-glow"),e.innerHTML='<span class="placeholder col-6"></span>';const n=document.getElementById("cacheW3WLink");n.setAttribute("class","card-text placeholder-glow"),n.innerHTML='<span class="placeholder col-7"></span><span class="placeholder col-4"></span><span class="placeholder col-4"></span><span class="placeholder col-6"></span><span class="placeholder col-8"></span>';const a=document.getElementById("cacheW3WBtn");a.removeAttribute("target"),a.removeAttribute("href"),a.setAttribute("tabindex","-1"),a.setAttribute("class","btn btn-primary m-1 disabled placeholder col-5"),a.innerHTML="";const i=document.getElementById("cacheMapsLink");i.removeAttribute("target"),i.removeAttribute("href"),i.setAttribute("tabindex","-1"),i.setAttribute("class","btn btn-primary m-1 disabled placeholder col-5"),i.innerHTML="";const o=document.getElementById("cacheFoundLink");o.removeAttribute("target"),o.removeAttribute("href"),o.setAttribute("tabindex","-1"),o.setAttribute("class","btn btn-outline-primary m-1 disabled placeholder col-4"),o.innerHTML=""}function loadFoundCachePage(t){changePage("viewCache",`Cache ${t}`,t),Swal.fire({title:`Found Cache ${t}?`,text:"If you've found this cache, please enter the 5-digit code below to mark it as found:",input:"text",inputAttributes:{autocomplete:"off",inputmode:"numeric",pattern:"[0-9]*",maxlength:5},showCancelButton:!0,buttonsStyling:!1,customClass:{cancelButton:"btn btn-outline-primary m-1",confirmButton:"btn btn-primary m-1",loader:"custom-loader"},loaderHtml:'<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Verifying code...</span></div>',returnFocus:!1,confirmButtonText:"Verify cache code",backdrop:!0,showLoaderOnConfirm:!0,allowOutsideClick:()=>!Swal.isLoading(),inputValidator:t=>t?5!==t.length||Number.isNaN(Number(t))?"This code is invalid":void 0:"You must enter the 5-digit code from the cache to confirm you have found it",preConfirm:e=>getApiAuth().then(n=>fetch("./api/found-cache",{method:"POST",body:JSON.stringify({cache:t,cacheCode:Number(e)}),headers:{"Content-Type":"application/json","Device-Id":n.deviceId,"Request-Id":n.requestId}})).then(t=>t.json()).then(handleErrors)}).then(e=>{e.isConfirmed?Swal.fire({title:"You did it!",text:e.value.success,icon:"success",buttonsStyling:!1,returnFocus:!1,showConfirmButton:!0,customClass:{confirmButton:"btn btn-primary m-1"},didOpen:()=>{Swal.hideLoading()},didClose:()=>{router.navigate(`viewCache-${t}`)}}):router.navigate(`viewCache-${t}`)}).catch(e=>{Swal.fire({title:e,icon:"error",buttonsStyling:!1,customClass:{confirmButton:"btn btn-primary m-1"},didOpen:()=>{Swal.hideLoading()},didClose:()=>{router.navigate(`viewCache-${t}`)}})})}function loadFoundCachesPage(){const t='<div class="p-3 text-center">\n\t\t<i class="bi bi-emoji-frown home-icon d-block mx-auto mb-4" aria-hidden="true"\n\t\t\trole="img"></i>\n\t\t<h1 class="display-6 fw-bold">You haven\'t found any geocaches (yet)</h1>\n\t\t<div class="col-lg-6 mx-auto">\n\t\t\t<p class="lead mb-4">Get outside and go find some!</p>\n\t\t\t<div class="d-grid gap-2 d-sm-flex justify-content-sm-center">\n\t\t\t\t<a href="viewCaches" class="btn btn-primary btn-lg px-4 gap-3" data-navigo>Find caches</a>\n\t\t\t</div>\n\t\t</div>\n\t</div>',e=loadingGif,n=document.getElementById("foundContainer");n.innerHTML=e,getApiAuth().then(t=>fetch("./api/found-caches",{method:"GET",headers:{"Device-Id":t.deviceId,"Request-Id":t.requestId}})).then(t=>t.json()).then(handleErrors).then(e=>{if(e.found.length>0){n.innerHTML='<div class="row">\n\t\t\t\t\t<div class="col-md-12 col-xl-4">\n\t\t\t\t\t\t<div class="card stat-card mb-2">\n\t\t\t\t\t\t\t<div class="card-body">\n\t\t\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t\t\t<div class="col">\n\t\t\t\t\t\t\t\t\t\t<p class="card-title text-muted mb-0">Device ID</p>\n\t\t\t\t\t\t\t\t\t\t<p class="font-weight-bold mb-0"><strong id="foundCachesDeviceId"></strong></p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="col-auto">\n\t\t\t\t\t\t\t\t\t\t<div class="icon rounded-circle my-3 my-sm-auto">\n\t\t\t\t\t\t\t\t\t\t\t<img id="foundCachesProfilePic" src="./img/loading.gif" alt="Loading placeholder...">\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="col-md-6 col-xl-4">\n\t\t\t\t\t\t<div class="card stat-card mb-2">\n\t\t\t\t\t\t\t<div class="card-body">\n\t\t\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t\t\t<div class="col">\n\t\t\t\t\t\t\t\t\t\t<p class="card-title text-muted mb-0">Caches found</p>\n\t\t\t\t\t\t\t\t\t\t<p class="font-weight-bold mb-0"><strong id="foundCachesTotal"></strong></p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="col-auto">\n\t\t\t\t\t\t\t\t\t\t<div class="icon icon-shape bg-primary text-white rounded-circle">\n\t\t\t\t\t\t\t\t\t\t\t<i class="bi bi-geo" aria-hidden="true"></i>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="col-md-6 col-xl-4">\n\t\t\t\t\t\t<div class="card stat-card mb-2">\n\t\t\t\t\t\t\t<div class="card-body">\n\t\t\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t\t\t<div class="col">\n\t\t\t\t\t\t\t\t\t\t<p class="card-title text-muted mb-0">Ranking</p>\n\t\t\t\t\t\t\t\t\t\t<p class="font-weight-bold mb-0"><strong id="foundCacheRanking"></strong></p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="col-auto">\n\t\t\t\t\t\t\t\t\t\t<div class="icon icon-shape bg-primary text-white rounded-circle">\n\t\t\t\t\t\t\t\t\t\t\t<i class="bi bi-trophy" aria-hidden="true"></i>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div id="foundWrapper"></div>';const t=new gridjs.Grid({columns:[{id:"id",name:"Cache number",sort:{enabled:!0},formatter:t=>gridjs.html(`<a href="viewCache-${DOMPurify.sanitize(t)}" data-navigo>${DOMPurify.sanitize(t)}</a>`)},{id:"date",name:"Found",sort:{enabled:!0},formatter:t=>{const e=new Date(t);return gridjs.html(`<time datetime="${DOMPurify.sanitize(t)}">${e.toLocaleTimeString("en-GB",{hour:"numeric",minute:"numeric",hour12:!0})} on ${prettyDate(t)}</time>`)}}],sort:!0,style:{table:{"white-space":"nowrap"}},pagination:{enabled:!0,limit:15,summary:!0},data:e.found}).render(document.getElementById("foundWrapper"));t.on("ready",function(){router.updatePageLinks()});const a=DOMPurify.sanitize(localStorage.getItem("deviceId"));document.getElementById("foundCachesDeviceId").innerText=a,document.getElementById("foundCachesProfilePic").setAttribute("src",`./profilePic/${a}/48`),document.getElementById("foundCachesProfilePic").setAttribute("alt",`Profile picture for ${a} (your device ID)`),document.getElementById("foundCachesTotal").innerText=Number(e.found.length),document.getElementById("foundCacheRanking").innerText=`${e.position}/${e.total}`}else n.innerHTML=t,router.updatePageLinks()}).catch(t=>{showError(t,!0)}),changePage("foundCaches","Found caches",!1)}function loadLeaderboardPage(){const t='<div class="p-3 text-center">\n\t\t<i class="bi bi-emoji-frown home-icon d-block mx-auto mb-4" aria-hidden="true"\n\t\t\trole="img"></i>\n\t\t<h1 class="display-6 fw-bold">No one has found any geocaches (yet)</h1>\n\t\t<div class="col-lg-6 mx-auto">\n\t\t\t<p class="lead mb-4">Get outside and go find some!</p>\n\t\t\t<div class="d-grid gap-2 d-sm-flex justify-content-sm-center">\n\t\t\t\t<button id="findCachesBtn" class="btn btn-primary btn-lg px-4 gap-3">Find caches</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>',e=loadingGif,n=document.getElementById("leaderboardContainer");n.innerHTML=e,fetch("./api/get-leaderboard",{method:"GET",headers:{"Device-Id":localStorage.getItem("deviceId")}}).then(t=>t.json()).then(handleErrors).then(e=>{if(e.length>0){n.innerHTML='<div id="leaderboardWrapper"></div>';const t=new gridjs.Grid({columns:[{id:"position",name:"Position",sort:{enabled:!0},formatter:t=>1===t?"1st ðŸ¥‡":2===t?"2nd ðŸ¥ˆ":3===t?"3rd ðŸ¥‰":t,attributes:(t,e)=>{if(t)return{"data-ranking":t,"data-match":String(Boolean(e.cells[1].data===localStorage.getItem("deviceId")))}}},{id:"deviceId",name:"Device ID",sort:{enabled:!0},formatter:t=>{const e=DOMPurify.sanitize(t);return gridjs.html(`<div class="row"><div class="col-md-4"><div class="icon rounded-circle"><img src="./profilePic/${e}/48" alt="Profile picture for ${e}"></div></div><div class="col-md-8 my-auto text-break">${e}${e===localStorage.getItem("deviceId")?"&nbsp;<strong>(You)</strong>":""}</div></div>`)}},{id:"found",name:"Number of caches found",sort:{enabled:!0}}],sort:!0,style:{table:{"white-space":"nowrap"}},data:e}).render(document.getElementById("leaderboardWrapper"));t.on("ready",function(){try{[...document.querySelector('td[data-ranking="1"]').parentElement.children].forEach(t=>{t.classList.add("gold")}),[...document.querySelector('td[data-ranking="2"]').parentElement.children].forEach(t=>{t.classList.add("silver")}),[...document.querySelector('td[data-ranking="3"]').parentElement.children].forEach(t=>{t.classList.add("bronze")}),[...document.querySelector('td[data-match="true"]').parentElement.children].forEach(t=>{t.classList.add("your-device")})}catch{}})}else n.innerHTML=t,router.updatePageLinks()}).catch(t=>{showError(t,!0)}),changePage("leaderboard","Leaderboard",!1)}let mainMap=null,router=null,newWorker=!1;const loadingGif='<div class="text-center"><img src="./img/loading.gif" class="img-fluid text-center" alt="Loading animation placeholder"></div>',showToast=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:t=>{t.addEventListener("mouseenter",Swal.stopTimer),t.addEventListener("mouseleave",Swal.resumeTimer)}});window.onload=function(){if(router=new Navigo("/"),router.on("/",function(){changePage("home","Home",!1)}).on("/home",function(){changePage("home","Home",!1)}).on("/viewCaches",function(){loadCachesPage()}).on("/viewCachesTable",function(){loadCachesTablePage()}).on("/viewCache-:id",function(t){loadCachePage(t.data.id)}).on("/foundCaches",function(){loadFoundCachesPage()}).on("/foundCache-:id",function(t){loadFoundCachePage(t.data.id)}).on("/leaderboard",function(){loadLeaderboardPage()}).on("/about",function(){changePage("about","About",!1)}).on("/disclaimer",function(){changePage("disclaimer","Disclaimer",!1)}).on("/terms",function(){changePage("terms","Terms and Conditions",!1)}).on("/privacy",function(){changePage("privacy","Privacy Policy",!1)}).on("/openSourceLicenses",function(){changePage("openSourceLicenses","Open Source Licenses",!1)}).notFound(function(){changePage("404","Page not found",!1)}).resolve(),null===localStorage.getItem("deviceId")&&getDeviceId(),"serviceWorker"in navigator){const t=document.getElementById("updateBtn");navigator.serviceWorker.register("service-worker.js").then(function(e){e.update(),e.addEventListener("updatefound",()=>{newWorker=e.installing,null===newWorker&&(newWorker=e.waiting),newWorker.addEventListener("statechange",()=>{"installed"===newWorker.state&&navigator.serviceWorker.controller&&(t.classList.remove("d-none"),t.removeAttribute("disabled"))})})}).catch(t=>{console.log(t)}),t.addEventListener("click",t=>{t.preventDefault(),newWorker.postMessage({action:"skipWaiting"}),window.location.reload()})}};