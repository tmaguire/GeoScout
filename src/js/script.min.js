function getDeviceId(){const e=FingerprintJS.load({apiKey:"a1ZJOENnGt4QCgAqBHHb",region:"eu",endpoint:"https://fp.withamscouts.org.uk"});e.then(e=>e.get()).then(e=>{null===localStorage.getItem("deviceId")&&localStorage.setItem("deviceId",e.visitorId)}).catch(e=>{console.warn(e)})}function showError(e,t){console.log(`Showing error message: ${e}`),t?Swal.fire({title:"Application error",text:e,icon:"error",buttonsStyling:!1,customClass:{confirmButton:"btn btn-primnary"},didOpen:()=>{Swal.hideLoading()}}):Swal.fire({title:"Application error",text:e,icon:"error",showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,didOpen:()=>{Swal.hideLoading()}})}function setLoadingIndicator(e,t){e?(console.log("Show full screen loading indicator"),Swal.fire({title:`${t}...`,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,customClass:{loader:"custom-loader"},loaderHtml:'<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>',didOpen:()=>{Swal.showLoading()}})):(console.log("Remove full screen loading indicator"),Swal.close())}function prettyDate(e){const t=["January","February","March","April","May","June","July","August","September","October","November","December"],n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],a=new Date(e),o=t[a.getMonth()],i=n[a.getDay()],r=String(a.getDate()),c=`${r}${"1"===r||"21"===r||"31"===r?"st":"2"===r||"22"===r?"nd":"3"===r||"23"===r?"rd":"th"}`;return`${i} ${c} of ${o} ${a.getFullYear()}`}function handleErrors(e){if(e.hasOwnProperty("error"))throw Error(e.error);if(e.hasOwnProperty("errorMessage"))throw Error(`${e.errorType}: ${e.errorMessage}`);return e}function loadCachesPage(){mainMap=new google.maps.Map(document.getElementById("mapContainer"),{center:{lat:51.80007,lng:.64038},zoom:14.3,restriction:{latLngBounds:{north:51.826601357825716,east:.7474966992187326,south:51.773523020732,west:.5332633007812326},strictBounds:!0},mapId:"6b8e857a992e95a7"}),fetch("./api/get-caches",{method:"GET",headers:{"Device-Id":localStorage.getItem("deviceId")}}).then(e=>e.json()).then(handleErrors).then(e=>{if(!e.hasOwnProperty("caches"))throw"Invalid response received";{let t=0;e.caches.forEach(e=>{t++;const n=new google.maps.Marker({position:{lat:Number(e.coordinates.split(",")[0]),lng:Number(e.coordinates.split(",")[1])},map:mainMap,title:`Cache ${e.id}`,label:String(t),animation:google.maps.Animation.DROP});n.addListener("click",()=>{router.navigate(`/viewCache-${e.id}`)})})}}).catch(e=>{showToast.fire({title:e,icon:"error"})}),changePage("map","View caches")}function loadCachePage(e){resetCachePage(),fetch("./api/get-cache",{method:"POST",body:JSON.stringify({cache:e}),headers:{"Content-Type":"application/json","Device-Id":localStorage.getItem("deviceId")}}).then(e=>e.json()).then(handleErrors).then(t=>{document.getElementById("cacheCard").removeAttribute("aria-hidden");const n=document.getElementById("cacheMapImg");n.setAttribute("src",`${DOMPurify.sanitize(t.image)}`),n.setAttribute("alt",`Map for Cache ${e}`);const a=document.getElementById("cacheHeader");a.setAttribute("class","card-title"),a.innerHTML="",a.innerText=`Cache ${e}`;const o=document.getElementById("cacheW3WLink");o.setAttribute("class","card-text");const i=String(DOMPurify.sanitize(t.location)).split("///")[1];o.innerHTML=`what3words address: <a href="https://what3words.com/${i}" target="_blank" translate="no">///${i}</a><br><br><strong id="cacheStats"></strong>`;const r=document.getElementById("cacheMapsLink");r.removeAttribute("tabindex"),r.setAttribute("class","btn btn-primary m-1"),r.setAttribute("href",`https://www.google.com/maps/dir/?api=1&destination=${DOMPurify.sanitize(t.coordinates)}&travelmode=walking`),r.setAttribute("target","_blank"),r.innerHTML='<i class="bi bi-geo-alt" aria-hidden="true"></i>&nbsp;Open in Google Maps';const c=document.getElementById("cacheFoundLink"),s=document.getElementById("cacheStats");t.found?(c.setAttribute("class","btn btn-outline-primary disabled m-1"),c.innerHTML='<i class="bi bi-patch-check" aria-hidden="true"></i>&nbsp;You\'ve already found this cache',s.innerText=`You ${1===Number(t.stats)?"are the only person that found this cache!":`and ${Number(t.stats)-1} other ${Number(t.stats)-1==1?"person":"people"} have found this cache`}`):(c.setAttribute("class","btn btn-outline-primary m-1"),c.setAttribute("href",`foundCache-${e}`),c.innerHTML='<i class="bi bi-123" aria-hidden="true"></i>&nbsp;Found this cache?',s.innerText=`${0===Number(t.stats)?"No one has found this cache yet. Can you find it?":`${Number(t.stats)} ${1===Number(t.stats)?"person":"people"} have found this cache - can you find it?`}`,c.onclick=function(){router.navigate(`/foundCache-${e}`)})}).catch(e=>{showToast.fire({title:e,icon:"error"})}),changePage("cache",`Cache ${e}`)}function changePage(e,t){document.querySelectorAll("a.nav-link").forEach(t=>{t.getAttribute("data-page")===e?(t.setAttribute("class","nav-link active"),t.setAttribute("aria-current","page")):(t.setAttribute("class","nav-link"),t.removeAttribute("aria-current"))}),document.querySelectorAll("section").forEach(t=>{t.id!==e&&(t.setAttribute("class","row mx-auto d-none"),t.setAttribute("aria-hidden","true"))}),document.getElementById(e).setAttribute("class","row mx-auto"),document.getElementById(e).setAttribute("aria-hidden","false"),document.title=`${t} | Witham Scouts Geocaching`}function resetCachePage(){document.getElementById("cacheCard").setAttribute("aria-hidden","true");const e=document.getElementById("cacheMapImg");e.setAttribute("src","./img/loading.gif"),e.setAttribute("alt","Loading animation placeholder");const t=document.getElementById("cacheHeader");t.setAttribute("class","card-title placeholder-glow"),t.innerHTML='<span class="placeholder col-6"></span>';const n=document.getElementById("cacheW3WLink");n.setAttribute("class","card-text placeholder-glow"),n.innerHTML='<span class="placeholder col-7"></span><span class="placeholder col-4"></span><span class="placeholder col-4"></span><span class="placeholder col-6"></span><span class="placeholder col-8"></span>';const a=document.getElementById("cacheMapsLink");a.removeAttribute("target"),a.setAttribute("href","#"),a.setAttribute("tabindex","-1"),a.setAttribute("class","btn btn-primary disabled placeholder col-5 m-1"),a.innerHTML="";const o=document.getElementById("cacheFoundLink");o.setAttribute("class","btn btn-outline-primary disabled placeholder col-4 m-1"),o.innerHTML=""}function foundCachePage(e){changePage("cache",`Cache ${e}`),Swal.fire({title:`Found Cache ${e}?`,text:"If you've found this cache, please enter the 5-digit code below to mark it as found:",input:"number",showCancelButton:!0,buttonsStyling:!1,customClass:{cancelButton:"btn btn-outline-primary m-1",confirmButton:"btn btn-primary m-1",loader:"custom-loader"},loaderHtml:'<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Verifying code...</span></div>',returnFocus:!1,confirmButtonText:"Verify cache code",backdrop:!0,showLoaderOnConfirm:!0,allowOutsideClick:()=>!Swal.isLoading(),inputValidator:e=>e?5!==e.length||Number.isNaN(Number(e))?"This code is invalid":void 0:"You must enter the 5-digit code from the cache to confirm you have found it",preConfirm:t=>fetch("./api/found-cache",{method:"POST",body:JSON.stringify({cache:e,cacheCode:Number(t)}),headers:{"Content-Type":"application/json","Device-Id":localStorage.getItem("deviceId")}}).then(e=>e.json()).then(handleErrors)}).then(t=>{t.isConfirmed?Swal.fire({title:"You did it!",text:t.value.success,icon:"success",buttonsStyling:!1,returnFocus:!1,showConfirmButton:!0,customClass:{confirmButton:"btn btn-primary m-1"},didOpen:()=>{Swal.hideLoading()},didClose:()=>{router.navigate(`viewCache-${e}`)}}):router.navigate(`viewCache-${e}`)}).catch(t=>{Swal.fire({title:t,icon:"error",buttonsStyling:!1,customClass:{confirmButton:"btn btn-primary m-1"},didOpen:()=>{Swal.hideLoading()},didClose:()=>{router.navigate(`viewCache-${e}`)}})})}function foundCachesPage(){const e='<div class="p-3 text-center">\n\t\t<i class="bi bi-emoji-frown home-icon d-block mx-auto mb-4" aria-hidden="true"\n\t\t\trole="img"></i>\n\t\t<h1 class="display-6 fw-bold">You haven\'t found any geocaches (yet)</h1>\n\t\t<div class="col-lg-6 mx-auto">\n\t\t\t<p class="lead mb-4">Get outside and go find some!</p>\n\t\t\t<div class="d-grid gap-2 d-sm-flex justify-content-sm-center">\n\t\t\t\t<button id="findCachesBtn" class="btn btn-primary btn-lg px-4 gap-3">Find caches</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>',t='<div class="text-center"><img src="./img/loading.gif" class="img-fluid text-center" alt="Loading animation placeholder"></div>',n=document.getElementById("foundContainer");n.innerHTML=t,fetch("./api/found-caches",{method:"GET",headers:{"Device-Id":localStorage.getItem("deviceId")}}).then(e=>e.json()).then(t=>{t.found.length>0?(n.innerHTML='<div id="wrapper"></div>',new gridjs.Grid({columns:[{id:"id",name:"Cache Number",sort:!0},{id:"date",name:"Found",sort:!0,formatter:e=>{const t=new Date(e);return`${t.toLocaleTimeString("en-GB",{hour12:!1})} on ${prettyDate(e)}`}}],data:t.found}).render(document.getElementById("wrapper"))):(n.innerHTML=e,document.getElementById("findCachesBtn").onclick=function(){router.navigate("/viewCaches")})}).catch(e=>{showError(e,!0)}),changePage("found","Found caches")}let mainMap,router;const showToast=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.addEventListener("mouseenter",Swal.stopTimer),e.addEventListener("mouseleave",Swal.resumeTimer)}});window.onload=function(){router=new Navigo("/"),router.on("/",function(){changePage("home","Home")}).on("/home",function(){changePage("home","Home")}).on("/viewCaches",function(){loadCachesPage()}).on("/viewCache-:id",function(e){loadCachePage(e.data.id)}).on("/foundCaches",function(){foundCachesPage()}).on("/foundCache-:id",function(e){foundCachePage(e.data.id)}).on("/about",function(){changePage("about","About")}).on("/disclaimer",function(){window.scrollTo({top:0,left:0,behavior:"smooth"}),changePage("disclaimer","Disclaimer")}).notFound(function(){changePage("404","Page not found")}).resolve(),null===localStorage.getItem("deviceId")&&getDeviceId()};