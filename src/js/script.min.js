function handleResponse(e){if(null!==e)username=e.account.username,loadApp();else{const e=msalInstance.getAllAccounts();if(null===e)return;e.length>1?console.warn("Multiple accounts detected."):1===e.length&&(username=e[0].username,loadApp())}}function signIn(){msalInstance.loginRedirect(requestObj)}function signOut(){const e={account:msalInstance.getAccountByUsername(username)};msalInstance.logout(e)}function getTokenRedirect(e){return e.account=msalInstance.getAccountByUsername(username),msalInstance.acquireTokenSilent(e).catch(t=>{if(console.warn("silent token acquisition fails. acquiring token using redirect"),t instanceof msal.InteractionRequiredAuthError)return msalInstance.acquireTokenRedirect(e);console.warn(t)})}function showError(e,t){console.log(`Showing error message: ${e}`),t?Swal.fire({title:"Application error",text:e,icon:"error",buttonsStyling:!1,customClass:{confirmButton:"btn btn-secondary"},didOpen:()=>{Swal.hideLoading()}}):Swal.fire({title:"Application error",text:e,icon:"error",showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,didOpen:()=>{Swal.hideLoading()}})}function setLoadingIndicator(e,t){e?(console.log("Show full screen loading indicator"),Swal.fire({title:`${t}...`,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,customClass:{loader:"custom-loader"},loaderHtml:'<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>',didOpen:()=>{Swal.showLoading()}})):(console.log("Remove full screen loading indicator"),Swal.close())}function prettyDate(e){const t=["January","February","March","April","May","June","July","August","September","October","November","December"],n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],a=new Date(e),o=t[a.getMonth()],r=n[a.getDay()],s=String(a.getDate()),i=`${s}${"1"===s||"21"===s||"31"===s?"st":"2"===s||"22"===s?"nd":"3"===s||"23"===s?"rd":"th"}`;return`${r} ${i} of ${o} ${a.getFullYear()}`}function handleErrors(e){if(e.hasOwnProperty("error"))throw Error(e.error);if(e.hasOwnProperty("errorMessage"))throw Error(`${e.errorType}: ${e.errorMessage}`);return e}function loadCachesPage(){mainMap=new google.maps.Map(document.getElementById("mapContainer"),{center:{lat:51.80007,lng:.64038},zoom:13,restriction:{latLngBounds:{north:51.826601357825716,east:.7474966992187326,south:51.773523020732,west:.5332633007812326},strictBounds:!0},mapId:"6b8e857a992e95a7"}),fetch("./api/get-caches").then(e=>e.json()).then(handleErrors).then(e=>{if(!e.hasOwnProperty("caches"))throw"Invalid response received";{let t=0;e.caches.forEach(e=>{t++;const n=new google.maps.Marker({position:{lat:Number(e.coordinates.split(",")[0]),lng:Number(e.coordinates.split(",")[1])},map:mainMap,title:`Cache ${e.id}`,label:String(t),animation:google.maps.Animation.DROP});n.addListener("click",()=>{router.navigate(`/viewCache-${e.id}`)})})}}).catch(e=>{showToast.fire({title:e,icon:"error"})}),changePage("map")}function loadCachePage(e){resetCachePage(),fetch("./api/get-cache",{method:"POST",body:JSON.stringify({cache:e}),headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(handleErrors).then(t=>{document.getElementById("cacheCard").removeAttribute("aria-hidden");const n=document.getElementById("cacheMapImg");n.setAttribute("src",`${DOMPurify.sanitize(t.image)}`),n.setAttribute("alt",`Map for Cache ${e}`);const a=document.getElementById("cacheHeader");a.setAttribute("class","card-title"),a.innerHTML="",a.innerText=`Cache ${e}`;const o=document.getElementById("cacheW3WLink");o.setAttribute("class","card-text");const r=String(DOMPurify.sanitize(t.location)).split("///")[1];o.innerHTML=`what3words address: <a href="https://what3words.com/${r}" target="_blank" translate="no">///${r}</a>`;const s=document.getElementById("cacheMapsLink");s.removeAttribute("tabindex"),s.setAttribute("class","btn btn-primary"),s.setAttribute("href",`https://www.google.com/maps/@?api=1&map_action=map&center=${DOMPurify.sanitize(t.coordinates)}&zoom=19&basemap=roadmap&layer=none`),s.setAttribute("target","_blank"),s.innerHTML='<i class="bi bi-geo-alt" aria-hidden="true"></i>&nbsp;Open in Google Maps';const i=document.getElementById("cacheFoundLink");i.removeAttribute("tabindex"),i.setAttribute("class","btn btn-outline-primary"),i.setAttribute("href",`foundCache-${e}`),i.setAttribute("data-navigo",!0),i.innerHTML='<i class="bi bi-123" aria-hidden="true"></i>&nbsp;Found this cache?'}).catch(e=>{showToast.fire({title:e,icon:"error"})}),changePage("cache")}function changePage(e){document.querySelectorAll("a.nav-link").forEach(t=>{t.getAttribute("data-page")===e?(t.setAttribute("class","nav-link active"),t.setAttribute("aria-current","page")):(t.setAttribute("class","nav-link"),t.removeAttribute("aria-current"))}),document.querySelectorAll("section").forEach(t=>{t.id!==e&&(t.setAttribute("class","row mx-auto d-none"),t.setAttribute("aria-hidden","true"))}),document.getElementById(e).setAttribute("class","row mx-auto"),document.getElementById(e).setAttribute("aria-hidden","false")}function resetCachePage(){document.getElementById("cacheCard").setAttribute("aria-hidden","true");const e=document.getElementById("cacheMapImg");e.setAttribute("src","./img/loading.gif"),e.setAttribute("alt","Loading animation placeholder");const t=document.getElementById("cacheHeader");t.setAttribute("class","card-title placeholder-glow"),t.innerHTML='<span class="placeholder col-6"></span>';const n=document.getElementById("cacheW3WLink");n.setAttribute("class","card-text placeholder-glow"),n.innerHTML='<span class="placeholder col-7"></span><span class="placeholder col-4"></span><span class="placeholder col-4"></span><span class="placeholder col-6"></span><span class="placeholder col-8"></span>';const a=document.getElementById("cacheMapsLink");a.removeAttribute("target"),a.setAttribute("href","#"),a.setAttribute("tabindex","-1"),a.setAttribute("class","btn btn-primary disabled placeholder col-5")}const msalConfig={auth:{clientId:"c8267731-79a3-4f25-9631-86492b136a27",authority:"https://login.microsoftonline.com/withamscouts.onmicrosoft.com",redirectUri:"/"},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!1}},requestObj={scopes:["User.Read"]},tokenRequest={scopes:["https://withamscouts.onmicrosoft.com/c8267731-79a3-4f25-9631-86492b136a27/App.Access"]},msalInstance=new msal.PublicClientApplication(msalConfig);let mainMap,router;msalInstance.handleRedirectPromise().then(handleResponse).catch(e=>{console.error(e)});const showToast=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.addEventListener("mouseenter",Swal.stopTimer),e.addEventListener("mouseleave",Swal.resumeTimer)}});window.onload=function(){router=new Navigo("/"),router.on("/",function(){changePage("home")}).on("/viewCaches",function(){loadCachesPage()}).on("/viewCache-:id",function(e){loadCachePage(e.data.id)}).on("/foundCache-:id",function(e){console.log(e.data.id),console.log(e)}).on("/about",function(){changePage("about")}).on("/disclaimer",function(){changePage("disclaimer")}).notFound(function(){changePage("404")}).resolve()};